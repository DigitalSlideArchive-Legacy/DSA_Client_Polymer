<!-- knockout is used by openseadragon image helper -->
<script src="../../scripts/libs/knockout-3.0.0.js"></script>
<script src="../../scripts/libs/openseadragon.min.js"></script>
<!-- Used to add the scale bar to the openseadragon viewer -->
<script src="../../scripts/libs/openseadragon-scalebar.js"></script>

<!-- Used to get viewer properties such as zoom -->
<script src="../../scripts/libs/openseadragon-imaginghelper.min.js"></script>
<script src="../../scripts/libs/openseadragon-viewerinputhook.min.js"></script>

<!-- Annotation scripts -->
<script src="../../scripts/annotations/annotations.js"></script>
<script src="../../scripts/annotations/annotationState_control_functions.js"></script>
<script src="../../scripts/annotations/openseadragon_setup_functions.js"></script>
<script src="../../scripts/annotations/mousetrap.min.js"></script>
<script src="../../scripts/annotations/colornames_to_hex_hash.js"></script>

<script src="../../scripts/annotations/viewer.js"></script>

<dom-module id="app-dsa">
   <style>
   </style>
   <template>
   	  <app-header on-color-change=updateColor on-draw-mode-changed=drawModeChanged on-shape-changed=shapeModeChanged></app-header>
   	  <app-workspace on-image-click = selectedImageToLoad></app-workspace>
	     <app-footer></app-footer>
	     <app-controlsidebar></app-controlsidebar>
   </template>
</dom-module>
<script>
   Polymer({
     is: 'app-dsa',

    properties: {
        viewer : Object,
        
    },
    
      _onHostHover: function(e){
        console.debug('hover');  
      },
    ready: function() {
     
       this.viewer = prepDSAViewer();
       var annotationState = window.annotationState = new AnnotationState();
       annotationState.setSeadragonViewer(this.viewer);
       annotation_setup_code(annotationState);

       annotationState.setDrawMode('rect');
       annotationState.setIsDrawing(false);

      },
      attached: function() {

        $(annotationState).on("annotationAdded", function(e){ 
          alert(annotationState.annotations[annotationState.annotations.length - 1]);
        })
      },
      selectedImageToLoad: function(e) {
        if(e.detail.workspace_whole_image_url)
        { 
          //alert("DSA: "+e.detail.workspace_whole_image_url);
          this.viewer.open(e.detail.workspace_whole_image_url);
        }
      
     },

     updateColor: function(e) {
        if(e.detail.drawing_color)
        { 
          annotationState.lineColor = e.detail.drawing_color;
        }    
     },

     drawModeChanged: function(e) {
          annotationState.setIsDrawing(e.detail.draw_mode);   
     },

     shapeModeChanged : function(e){

      switch(e.detail.shape_mode) {
          case 0: 
            annotationState.setDrawMode('rect');
          break;

          case 1: 
          annotationState.setDrawMode('circle');
          break;

          case 2:
          annotationState.setDrawMode('polygon');
          break;

          case 3: 
          annotationState.setDrawMode('poi');
          break;

      }
     }
   });

</script>
